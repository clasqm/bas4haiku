#!/bin/sh

#adjust the following:
pkgname=bas_64
version=_2.4-5
srclocation=/Storage/source/git/bas4haiku
reponame=/Storage/projects/repo_devel_64
besharemsg="bas is a BASIC interpreter"

#list dependencies and update if necessary
pkgman update ncurses6 gettext gettext_libintl

#generated paths - do not edit
scriptname="$(readlink -f ${BASH_SOURCE[0]})"
archlocation=$srclocation/$(getarch)
thisarch=_$(getarch)
srclocationinpackage=/Storage/projects/ports/$pkgname/data/src/$pkgname
pkgfileslocation=/Storage/projects/ports/$pkgname
mkdir -p $archlocation

#compile - edit this as required
cd $srclocation
./configure
make
make clean
#move files to where they are required for packaging
mv -f  bas /Storage/projects/ports/$pkgname/bin
chmod +x /Storage/projects/ports/$pkgname/bin/bas
cp -f bas.1 /Storage/projects/ports/$pkgname/documentation/man/man1
cp -f bas.pdf /Storage/projects/ports/$pkgname/documentation/packages/bas
cp -f README /Storage/projects/ports/$pkgname/documentation/packages/bas

#backup latest packaging script and datafile to git location
cp -f $scriptname $archlocation
cp -f $pkgfileslocation/.PackageInfo $archlocation

#update github
git add *
git commit -m "$(date)"
git push 

#update src inside package
cd ..
zip -r9yq $pkgname.zip bas4haiku/*
mv -f $pkgname.zip $srclocationinpackage

#create package
cd $pkgfileslocation
package create -b $pkgname$version$thisarch.hpkg
sleep 0.5
package add $pkgname$version$thisarch.hpkg data bin documentation
sleep 0.5
addattr BeShare:Info "$besharemsg" $pkgname$version$thisarch.hpkg
cp -f $pkgname$version$thisarch.hpkg "/Storage/Haiku/My ports"
mv -f $pkgname$version$thisarch.hpkg $reponame

#backup packaging directory
cd ..
zip -r9yq $pkgname.zip $pkgname/*
mv -f $pkgname.zip /Storage/Haiku/ports_bkp

#link packaging script to bin
ln -s -f $scriptname /boot/home/config/non-packaged/bin

sync
